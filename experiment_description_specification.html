<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Experiment Description Specification &mdash; MESSES 0.1.dev1+g144a391 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom_css.css" type="text/css" />
      <link rel="stylesheet" href="_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js"></script>
        <script src="_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Protocol-Dependent Schema" href="protocol_dependent_schema.html" />
    <link rel="prev" title="Conversion Directives" href="conversion_directives.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MESSES
          </a>
              <div class="version">
                0.1.dev1+g144a391
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="tagging.html">Tagging</a></li>
<li class="toctree-l1"><a class="reference internal" href="conversion_directives.html">Conversion Directives</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Experiment Description Specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#terminology">Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-tables">Overview of Tables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#project">project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#study">study</a></li>
<li class="toctree-l3"><a class="reference internal" href="#protocol">protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="#entity">entity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#measurement">measurement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#factor">factor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#additional-rules">Additional Rules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id-fields">ID Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subject-sample-inheritance-rules">Subject/Sample Inheritance Rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-protocol-types">Overview of Protocol Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#treatment">treatment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#collection">collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sample-prep">sample_prep</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">measurement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storage">storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#best-practices-for-designing-your-experiment-description-data-schema">Best Practices For Designing Your Experiment Description Data Schema</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#protocols">Protocols</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">treatment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">collection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">sample_prep</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">measurement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">storage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#entities">Entities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#measurements">Measurements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#useful-patterns">Useful Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#connecting-records-to-file-names">Connecting Records to File Names</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="protocol_dependent_schema.html">Protocol-Dependent Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported_formats.html">Supported Conversion Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">TODO List</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MESSES</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Experiment Description Specification</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/experiment_description_specification.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="experiment-description-specification">
<h1>Experiment Description Specification<a class="headerlink" href="#experiment-description-specification" title="Permalink to this heading"></a></h1>
<section id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this heading"></a></h2>
<ul>
<li><p><strong>record/entry</strong> - collection of fields and attributes with a unique identifier organized together.</p>
<blockquote>
<div><ul class="simple">
<li><p>Example: “sample_01”: {“type”:”tissue”, “weight”:”30”, “units”:”grams”}</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>field/attribute/property</strong> - piece of data with a unique identifier associated with a record.</p>
<blockquote>
<div><ul class="simple">
<li><p>Example: weight for a sample entity record.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="overview-of-tables">
<h2>Overview of Tables<a class="headerlink" href="#overview-of-tables" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>The data schema developed for MESSES was designed to capture generalized experimental descriptions and data in an abstract way.</dt><dd><ul class="simple">
<li><p>The data schema is organized into several tables with a unique record identifier and a flexible collection of fields.</p></li>
<li><dl class="simple">
<dt>This schema has the following tables:</dt><dd><ul>
<li><p>entity</p></li>
<li><p>protocol</p></li>
<li><p>measurement</p></li>
<li><p>factor</p></li>
<li><p>project</p></li>
<li><p>study</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Although the tables have been generally described below, there are more details and logic needed to explain the framework.</p></li>
</ul>
</dd>
</dl>
<section id="project">
<h3>project<a class="headerlink" href="#project" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>A project generally refers to a research project with multiple analytical datasets derived from one or more experimental designs.</strong></dt><dd><ul class="simple">
<li><p>It is somewhat arbitrary how to categorize a project, but defining one project per group of related analytical datasets derived from a single experiment is a good start.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="study">
<h3>study<a class="headerlink" href="#study" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>A study is generally one experimental design or analytical experiment inside of the project.</strong></dt><dd><ul class="simple">
<li><p>For instance, if you are testing the effectiveness of a treatment on lung cancer and you try the treatment on both cell lines and mice, the cell line experiment would be one study and the mouse experiment another.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="protocol">
<h3>protocol<a class="headerlink" href="#protocol" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>A protocol describes an operation or set of operations done on a subject or sample entity.</strong></dt><dd><ul class="simple">
<li><p>For example, if mouse organs are frozen in liquid nitrogen and then ground into powder, this could be either 1 protocol to describe both operations or 2 to separate the freezing step and grinding step.</p></li>
<li><p>How to break operations up can be an arbitrary decision, but some good rules of thumb are to make operations with significant time between them separate protocols, or if there are measurements associated with an operation.</p></li>
<li><p>For example, if the tissue is weighed before and after freezing and before and after grinding, it might be a good idea to have the operations in separate protocols so the weights are clearly associated with each operation.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="entity">
<h3>entity<a class="headerlink" href="#entity" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>Entities are either subjects or samples which are similar to each other and interconnected.</strong></dt><dd><ul class="simple">
<li><dl class="simple">
<dt>A subject is something that receives a treatment, or is subjected to different experimental factors.</dt><dd><ul>
<li><p>For example, if you are testing a treatment on a cell line in 6 different petri dishes (1 treatment with 3 replicates and 1 null with 3 replicates), each petri dish would be a separate subject.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Samples are collected from subjects.</dt><dd><ul>
<li><p>For example, if we revisit the previous example and assume that media is collected from each petri dish, the collected media from each petri dish would be a separate sample.</p></li>
<li><p>Samples can also come from other samples. For example, if you take the previously described media samples and take a portion or the entire sample, and then perform several steps before measuring something, such as adding a solvent and/or some other preparation step, the newly modified sample or portion technically becomes a new sample that was derived from the original sample.</p></li>
<li><dl class="simple">
<dt>Samples can also become subjects if they are subjected to a treatment.</dt><dd><ul>
<li><p>For example, when a cancer sample is extracted from a person and then pieces are implanted in mice for testing with specific treatments, the mice are subjects with sample parents.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Determining what is a sample and a subject can be confusing, but largely the key is whether or not the thing in question underwent a treatment or has an experimental factor of interest.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Entities must have a “type” field that indicates whether it is a “subject” or “sample”.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="measurement">
<h3>measurement<a class="headerlink" href="#measurement" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>A measurement is typically the results acquired after putting a sample through an assay or a sophisticated machine such as a mass spec or NMR, as well as any calculations on these results that is used for analysis.</strong></dt><dd><ul class="simple">
<li><p>This is what people will typically think of as data while the information in the other tables would be experimental metadata.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="factor">
<h3>factor<a class="headerlink" href="#factor" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>A factor is a controlled independent variable of the experimental design. Experimental factors are conditions set in the experiment. Other factors may be other classifications such as male or female gender.</strong></dt><dd><ul class="simple">
<li><p>For example, if there are different treatments done to cell lines this would be a factor.</p></li>
<li><p>Each treatment would be a separate protocol, but the different protocols would be 1 factor.</p></li>
<li><p>If an experiment also looks at age, race, gender, etc. then these would each be separate factors.</p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="additional-rules">
<h2>Additional Rules<a class="headerlink" href="#additional-rules" title="Permalink to this heading"></a></h2>
<section id="id-fields">
<h3>ID Fields<a class="headerlink" href="#id-fields" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>Any field for any record that ends in “.id” must be an id to an existing record in that field’s table.</strong></dt><dd><ul class="simple">
<li><p>For instance, if the field “protocol.id” : “tissue_extraction” is in a sample record then the protocol table must contain a record with the id “tissue_extraction”.</p></li>
<li><p>Similarly, if a record has the “parent_id” field the value must be an existing id in the same table as that record. For example, if “parent_id” : “tissue_extraction” is in a record in the protocol table then the protocol table must contain a record with the id “tissue_extraction”.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="subject-sample-inheritance-rules">
<h3>Subject/Sample Inheritance Rules<a class="headerlink" href="#subject-sample-inheritance-rules" title="Permalink to this heading"></a></h3>
<blockquote>
<div><ul class="simple">
<li><p>If a sample comes from a sample, it must have a sample_prep type protocol.</p></li>
<li><p>If a sample comes from a subject, it must have a collection type protocol.</p></li>
<li><p>Subjects should have a treatment type protocol.</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="overview-of-protocol-types">
<h2>Overview of Protocol Types<a class="headerlink" href="#overview-of-protocol-types" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt><strong>There are currently 5 different types of protocols:</strong></dt><dd><ul class="simple">
<li><p>treatment</p></li>
<li><p>collection</p></li>
<li><p>sample_prep</p></li>
<li><p>measurement</p></li>
<li><p>storage</p></li>
</ul>
</dd>
</dl>
<section id="treatment">
<h3>treatment<a class="headerlink" href="#treatment" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>A treatment protocol is used to describe the experimental factors done to subject entities.</strong></dt><dd><ul class="simple">
<li><p>For example, if a cell line is given 2 different media solutions to observe the different growth behavior between the 2, then this would be a treatment type protocol.</p></li>
<li><p>Each treatment would be a separate protocol that describes the specifics of the solution or other factors.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="collection">
<h3>collection<a class="headerlink" href="#collection" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>A collection protocol is used to describe how samples are collected from subject entities.</strong></dt><dd><ul class="simple">
<li><p>For example, if media is taken out of a cell culture at various time points, this would be a collection protocol.</p></li>
<li><p>Details such as the time of collection and the weight or volume of collection may be some of the attributes associated with the protocol.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="sample-prep">
<h3>sample_prep<a class="headerlink" href="#sample-prep" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>A sample_prep protocol is used to describe operations done to sample entities.</strong></dt><dd><ul class="simple">
<li><p>Typically, these operations would be done or are necessary in preparation for going into a measuring device.</p></li>
<li><p>For example, once the cells in a culture are collected, they may be spun in a centrifuge or have solvents added to separate out protein, lipids, etc.</p></li>
<li><p>These steps would be a sample_prep protocol.</p></li>
<li><p>How to organize such operations into protocols can be arbitrary and is left to the discretion of the creator.</p></li>
<li><p>Details such as the concentration of solvents, speed of the centrifuge, or weight of the separated parts may be some attributes associated with the protocol.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="id1">
<h3>measurement<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>A measurement protocol is used to describe operations done on samples to measure features about them.</strong></dt><dd><ul class="simple">
<li><p>For example, if a sample is put through a mass spectrometer or into an NMR.</p></li>
<li><p>Typically, the results of the measurement will be attributes associated with the protocol.</p></li>
<li><p>This is also the protocol type used for any analysis or calculations done on the data generated by instruments such as a mass spectrometer.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="storage">
<h3>storage<a class="headerlink" href="#storage" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><strong>A storage protocol is used to describe where things are stored.</strong></dt><dd><ul class="simple">
<li><p>This was created mostly to help keep track of where samples were physically stored in freezers or where measurement data files were located on a share drive.</p></li>
<li><p>But this protocol should include other storage details like temperature for the physical storage of samples.</p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="best-practices-for-designing-your-experiment-description-data-schema">
<h2>Best Practices For Designing Your Experiment Description Data Schema<a class="headerlink" href="#best-practices-for-designing-your-experiment-description-data-schema" title="Permalink to this heading"></a></h2>
<p>So far, this document has focused on the mechanics or rules of the experiment description specification, but there are many different
ways to create a data schema for the same experiment description. Creating an experimental description data schema is a balance between
storing data in a human readable way, storing data in a space saving way (not repeating fields), and storing data in a machine
readable way. For the most part, the biggest question to answer is what table or what type of records a piece of information should
go into. Some will seem obvious, such as putting a sample’s weight measurement on the sample’s entity record instead of creating a
measurement record associated with that sample’s entity record. Others may have several options with advantages and disadvantages.
For example, where should you put the name of the raw file generated by a mass spectrometer? On the measurement protocol? On a
storage protocol associated with the measured entity? On the entity that was measured? On the measurement records? There can be
good reasons for putting the information in different locations and you may have to decide what is best for your situation. This
section will try to outline some rules and examples of good ways to construct a data schema based on what the <a class="reference internal" href="supported_formats.html"><span class="doc">Supported Conversion Formats</span></a>
expect for the conversion command and other factors such as saving space.</p>
<p>You don’t necessarily have to capture absolutely everything about your experiment. Most likely you are doing this in order to
upload your data into a public repository, so it is a good idea to understand what information that repository wants or allows
and tailor your data schema to that. For instance, if you store some samples in a freezer during the experiment, you may not have to
capture the temperature they are stored at because the repository doesn’t have a place for you to give that information
to them. However, repository deposition requirements do change. So if it is easy to capture it, it is better to capture it, because
you may need it eventually.</p>
<section id="protocols">
<h3>Protocols<a class="headerlink" href="#protocols" title="Permalink to this heading"></a></h3>
<p>You may understand every step that was taken in your experimental design, but determining how to group and categorize the steps
into protocols can be challenging. It is a good idea to write out everything that was done in an experiment in order to get a
measurement. Using a flowchart can be very effective at identifying protocols needed to capture the whole experimental process.
This can then be used to help group and categorize what was done into the types of protocols defined by the data schema.</p>
<section id="id2">
<h4>treatment<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h4>
<ul>
<li><p>A treatment protocol will usually be the first protocol and there will often be at least 2 because the control should be considered
a separate treatment protocol.</p>
<blockquote>
<div><ul class="simple">
<li><p>If you did not have controls, but had different subject types then you can create a treatment protocol for
each different subject type, even though the procedure is the same. Whether or not this is a good idea is up to you and the data
repository you are targeting.</p></li>
<li><p>A treatment is usually the procedure that is done to the subjects that induces some kind of change that is of interest to be
investigated through measurement. This is different from a sample_prep protocol which describes a procedure done to samples,
typically to enable some type of a measurement or to preserve the sample for later use.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Some good information to put in the fields of the protocol are things like dosages or measurable bits of information that differ
between treatments. Always make sure to put a good description in the description field. A filename to a document that describes
the protocol in much more detail can be given in a filename field.</p>
</section>
<section id="id3">
<h4>collection<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h4>
<ul>
<li><p>A collection is only made from a subject, and subjects must receive a treatment. So it is a good idea to start by identifying
what the treatment is, which will identify the subjects.</p></li>
<li><p>When things are taken from the subjects or if they are sacrificed and
transformed, then a collection has happened and a collection protocol is used to indicate that.</p></li>
<li><p>The collection protocol
should be a protocol for the newly created sample, not the subject it was collected from.</p></li>
<li><p>If you collect many different things
from a subject, such as many different organs from a sacrificed mouse, you can make a protocol for each different tissue type,
or 1 protocol that collects them all.</p>
<blockquote>
<div><ul class="simple">
<li><p>It is ultimately up to you, but generally it would be separated by procedure. For example,
the aforementioned sacrificed mouse would have all of its organs collected at the same time in the same way, so 1 protocol is
probably more appropriate. If you collect blood from the mouse at different times as well as when it is sacrificed, then it is
probably better to make the blood collection a separate protocol.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Some good information to put in the fields of the protocol are things like the type of sample being collected, such as tissue,
plasma, media, etc. Similar collections done at different times can record time points on the protocol itself (requiring a new
protocol for each time point), or on the newly acquired sample created from the collection. The latter is what is recommended.
Always make sure to put a good description in the description field. A filename to a document that describes the protocol
in much more detail can be given in a filename field.</p>
</section>
<section id="id4">
<h4>sample_prep<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h4>
<ul>
<li><p>sample_prep protocols are typically procedures done to samples to enable a measurement or preserve a sample for later use.</p></li>
<li><p>Most of the steps done to samples will likely fall into this type of protocol.</p></li>
<li><p>What can be difficult is deciding which steps to organize under different
protocols.</p></li>
<li><p>There is generally some middle ground between putting every step under one protocol and making every step its own
protocol.</p>
<blockquote>
<div><ul>
<li><p>If a set of steps are always done together, then that is a good indication they should be together in one protocol.</p></li>
<li><p>If some steps are separated by a significant amount of time or the later steps are not always done, then this is a good indication
that the later steps should be part of a separate protocol.</p>
<blockquote>
<div><ul class="simple">
<li><p>For example, if you harvest mouse organs, freeze them immediately, but only sometimes grind them into powder or the
grinding is sometimes done the next day, then making the freezing and grinding separate protocols is a good idea.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Steps done for different purposes are also a good reason to put them in different protocols.</p>
<blockquote>
<div><ul class="simple">
<li><p>For example, a freezing step may be done to stop metabolic activity, while a step that adds a solvent may be done to separate
compounds of interest.</p></li>
<li><p>Both of the previous steps are done for the larger purpose of enabling accurate and precise measurements,
but have a more specific purpose inside that larger purpose.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Some good information to put in the fields of the protocol would be the amounts or weights of anything added to a sample or taken
away if it is the same for each sample. For example, if you add 20uL of a solvent to every sample, then adding that as a field is
a good idea. But if you add an amount that is proportional to sample weight or differs between samples then it is probably better
to have that as a field on the sample. Other important details or things that can be measured are good targets to add as fields
for the protocols. For example, if you add a solvent at a certain temperature, then it may be a good idea to record that temperature.
Always make sure to put a good description in the description field. A filename to a document that describes the protocol
in much more detail can be given in a filename field.</p>
</section>
<section id="id5">
<h4>measurement<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>measurement protocols are typically the last thing done to a sample in order to quantify something of interest, but if the measurement
is non-destructive then there may be more later.</p></li>
<li><p>Procedures that operate on entities usually stop after taking a measurement, but additional statistical or analytical steps may
continue on the measurement results.</p></li>
<li><p>The analysis or statistical steps can be included in the protocol that describes taking the initial raw measurements, or they can
be separated into their own measurement type protocols.</p></li>
<li><p>There is no rule that says a measurement type protocol cannot be on an entity, but typically only measurement records will have
measurement type protocols.</p></li>
<li><p>Just because a measurement was taken during a procedure doesn’t mean it has to be a measurement type.</p></li>
</ul>
<p>The measurements themselves should be fields on measurement records, but other important information needs to be in the fields
of the measurement protocol. Good targets for information to be in the measurement protocol are the software used, the machine
used, and specific settings or details about the software or machine, such as version number or the type of chromatography used.
Always make sure to put a good description in the description field. A filename to a document that describes the protocol
in much more detail can be given in a filename field.</p>
</section>
<section id="id6">
<h4>storage<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h4>
<ul>
<li><p>storage protocols are for indicating when something was stored.</p>
<blockquote>
<div><ul class="simple">
<li><p>This can be an entity or a file.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>They were originally created to help keep track of where entities and files were located, but that function is not likely
to be useful for depositing into an online repository.</p></li>
<li><p>They can still be useful for indicating that an entity was stored somewhere, instead of including it as part of a sample_prep
protocol.</p>
<blockquote>
<div><ul class="simple">
<li><p>Doing this is a good way to highlight specifically that the entity was stored, and how it was stored.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Good information to put on storage protocols are the location of storage, temperature of storage (if relevant), and date of
storage. This information can be on the protocol itself, but it might be better for it to be on the entity the protocol is
associated with. Determine what is best for your situation.</p>
</section>
</section>
<section id="entities">
<h3>Entities<a class="headerlink" href="#entities" title="Permalink to this heading"></a></h3>
<p>Entities and protocols have an interdependent relationship. Entities must have at least 1 protocol associated with them, and
protocols describe what was done to the entities. Two of the biggest challenges are determining how to break up the experiment
procedures into protocols and how to create entities from experiment subjects and samples. Due to their interdependence, this
can be confusing. The following are some tips that can help:</p>
<ul>
<li><p>If any sort of collection takes place (blood, tissue, media, etc.), then the entity it came from must be a subject and the collected
entity is a sample that must have a collection protocol associated with it.</p>
<blockquote>
<div><ul class="simple">
<li><p>The subject must be the parent_id of the sample.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If a sample is aliquoted into different portions, then each portion becomes a new separate entity and those entities parent_id’s
are the original sample.</p>
<blockquote>
<div><ul class="simple">
<li><p>Portions that do not go on to be measured may be omitted in a data deposition. Use your own judgment.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>New entities should not be created for every individual sample preparation step, but major steps/procedures that enable a measurement.</p>
<blockquote>
<div><ul class="simple">
<li><p>New derivative samples should be used to describe the procedures needed to craft a sample for a specific analytical measurement.</p></li>
<li><p>If the samples are only used for a single type of analytical measurement, then the protocol needed to create the actual sample
used for the measurement could just be part of the list of protocols for the sample.</p></li>
<li><p>But if the samples need to be split and processed into separate samples for different types of analytical measurements,
then this will need derivatives samples that have the associated specific sample_prep protocol.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If there is a significant amount of time between sample_prep protocols, or the sample is stored for a period of time, then it
may be a good idea to create a new derivative entity after it is taken out of storage or after the delay between steps.</p></li>
<li><p>If there is a protocol that is not always done, or is not done to all of the samples, then that is a good indication to create
a new derivative entity when that protocol is done on an entity.</p></li>
</ul>
<p>It can be useful to think about what real world physical samples existed during the experiment. For example, if you treat a mouse
and tissue is collected from it that then has other procedures applied to make it measurable, then it can be helpful to create
a diagram depicting the mouse, each tissue, and each test tube after that. This diagram can then be filled in with protocols
connecting one to the next. An example is shown below.</p>
<figure class="">
            <a 
               data-lightbox="group-f5e76dd5-6e1d-4503-ab1d-0fd2badbbbdf"
               href="_images/mouse_diagram.png"
               title="Diagram showing an example experiment. The first layer depicts the real physical samples and places
protocols along the way. The second layer is a written description of each step. The third layer is
an example of how the entities could be constructed. This is created from the mwtab example in the
examples folder of the GitHub repository. Note that not everything is shown. Only some tissues are
shown and only the aliquot that ended in a measurement is shown."
               data-title="Diagram showing an example experiment. The first layer depicts the real physical samples and places
protocols along the way. The second layer is a written description of each step. The third layer is
an example of how the entities could be constructed. This is created from the mwtab example in the
examples folder of the GitHub repository. Note that not everything is shown. Only some tissues are
shown and only the aliquot that ended in a measurement is shown."
               
               ><img src="_images/mouse_diagram.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><figcaption>Diagram showing an example experiment. The first layer depicts the real physical samples and places
protocols along the way. The second layer is a written description of each step. The third layer is
an example of how the entities could be constructed. This is created from the mwtab example in the
examples folder of the GitHub repository. Note that not everything is shown. Only some tissues are
shown and only the aliquot that ended in a measurement is shown.</figcaption>
            </figure></section>
<section id="measurements">
<h3>Measurements<a class="headerlink" href="#measurements" title="Permalink to this heading"></a></h3>
<p>There are usually many measurements taken during an experiment, but not all of them need to go in the “measurement” table. Generally,
experiments result in one or more end point measurements and these are what will go in the “measurement” table. Assuming you are
uploading to a repository that repository might also influence what goes in the “measurement” table. For example, a mouse experiment
might use a mass spectrometer and a nuclear magnetic resonance spectrometer to take measurements of metabolites in mouse tissue.
The purpose of the experiment was to be able to analyze and compare these metabolite measurements, so they are the end point measurements.
You also want to upload them to the Metabolomics Workbench, which expects metabolite measurements from MS and NMR arranged in a specific
way. These are both good reasons to have them be in the “measurement” table.</p>
<p>Analysis and transformations of the measurements should also go in the same record as the measurement. For example, if you identified
a peak in a mass spectrometry spectra as glucose and put the peak area measurement in the “measurement” table, then you would also want
to put any normalization calculations with it in the same measurement record. So the glucose record would have a field for raw_intensity
and corrected_raw_intensity.</p>
<p>You have decided what should be in the “measurement” table, but there is still the question of how exactly to create the records.
Sticking with our mouse experiment example, you could create 1 record per metabolite and have the measurements for each sample as a
separate field (ex sample1_raw_intensity, sample2_raw_intensity, etc.). What the convert command expects, however, is a separate record for each
metabolite-sample combination. Ex:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;measurement&quot;: {</span>
<span class="go">    &quot;Glucose-Sample1&quot;: {</span>
<span class="go">      &quot;assignment&quot;: &quot;Glucose&quot;,</span>
<span class="go">      &quot;assignment%method&quot;: &quot;database&quot;,</span>
<span class="go">      &quot;compound&quot;: &quot;Glucose&quot;,</span>
<span class="go">      &quot;concentration&quot;: &quot;0&quot;,</span>
<span class="go">      &quot;concentration%type&quot;: &quot;calculated from standard&quot;,</span>
<span class="go">      &quot;concentration%units&quot;: &quot;uM&quot;,</span>
<span class="go">      &quot;corrected_raw_intensity&quot;: &quot;8447352.89211&quot;,</span>
<span class="go">      &quot;corrected_raw_intensity%type&quot;: &quot;natural abundance corrected peak area&quot;,</span>
<span class="go">      &quot;entity.id&quot;: &quot;Sample1&quot;,</span>
<span class="go">      &quot;formula&quot;: &quot;C6H12O6&quot;,</span>
<span class="go">      &quot;id&quot;: &quot;Glucose-Sample1&quot;,</span>
<span class="go">      &quot;intensity&quot;: &quot;13664945.509939667&quot;,</span>
<span class="go">      &quot;intensity%type&quot;: &quot;natural abundance corrected and protein normalized peak area&quot;,</span>
<span class="go">      &quot;intensity%units&quot;: &quot;area/g&quot;,</span>
<span class="go">      &quot;normalized_concentration&quot;: &quot;0&quot;,</span>
<span class="go">      &quot;normalized_concentration%type&quot;: &quot;protein normalized&quot;,</span>
<span class="go">      &quot;normalized_concentration%units&quot;: &quot;uMol/g&quot;,</span>
<span class="go">      &quot;protocol.id&quot;: &quot;ICMS1&quot;,</span>
<span class="go">      &quot;raw_intensity&quot;: &quot;7989221.83386388&quot;,</span>
<span class="go">      &quot;raw_intensity%type&quot;: &quot;spectrometer peak area&quot;</span>
<span class="go">    },</span>
<span class="go">    &quot;Glucose-Sample2&quot;: {</span>
<span class="go">      &quot;assignment&quot;: &quot;Glucose&quot;,</span>
<span class="go">      &quot;assignment%method&quot;: &quot;database&quot;,</span>
<span class="go">      &quot;compound&quot;: &quot;Glucose&quot;,</span>
<span class="go">      &quot;concentration&quot;: &quot;0&quot;,</span>
<span class="go">      &quot;concentration%type&quot;: &quot;calculated from standard&quot;,</span>
<span class="go">      &quot;concentration%units&quot;: &quot;uM&quot;,</span>
<span class="go">      &quot;corrected_raw_intensity&quot;: &quot;2885161.33083&quot;,</span>
<span class="go">      &quot;corrected_raw_intensity%type&quot;: &quot;natural abundance corrected peak area&quot;,</span>
<span class="go">      &quot;entity.id&quot;: &quot;Sample2&quot;,</span>
<span class="go">      &quot;formula&quot;: &quot;C6H12O6&quot;,</span>
<span class="go">      &quot;id&quot;: &quot;Glucose-Sample2&quot;,</span>
<span class="go">      &quot;intensity&quot;: &quot;6235697.006728272&quot;,</span>
<span class="go">      &quot;intensity%type&quot;: &quot;natural abundance corrected and protein normalized peak area&quot;,</span>
<span class="go">      &quot;intensity%units&quot;: &quot;area/g&quot;,</span>
<span class="go">      &quot;isotopologue&quot;: &quot;13C0&quot;,</span>
<span class="go">      &quot;isotopologue%type&quot;: &quot;13C&quot;,</span>
<span class="go">      &quot;normalized_concentration&quot;: &quot;0&quot;,</span>
<span class="go">      &quot;normalized_concentration%type&quot;: &quot;protein normalized&quot;,</span>
<span class="go">      &quot;normalized_concentration%units&quot;: &quot;uMol/g&quot;,</span>
<span class="go">      &quot;protocol.id&quot;: &quot;ICMS1&quot;,</span>
<span class="go">      &quot;raw_intensity&quot;: &quot;2728688.40604858&quot;,</span>
<span class="go">      &quot;raw_intensity%type&quot;: &quot;spectrometer peak area&quot;</span>
<span class="go">    },</span>
<span class="go">    ...</span>
<span class="go">}</span>
</pre></div>
</div>
<p>We have found this form to be the best practice. Note that not every field shown is required for the convert command.
To know what is required by default, or to modify it to fit your situation, it is recommended to read the <a class="reference internal" href="conversion_directives.html"><span class="doc">Conversion Directives</span></a>
and <a class="reference internal" href="supported_formats.html"><span class="doc">Supported Conversion Formats</span></a> sections, and use the “save-directives” sub-command for the convert command to investigate
the specific fields required for your repository upload. Also notice the “field%type” and “field%units” attribute fields
for the measurement values. Attributes are the recommended way to indicate additional information about a measurement value.</p>
</section>
<section id="useful-patterns">
<h3>Useful Patterns<a class="headerlink" href="#useful-patterns" title="Permalink to this heading"></a></h3>
<p>The following are some problems and ways to deal with them.</p>
<section id="connecting-records-to-file-names">
<span id="raw-files-method"></span><h4>Connecting Records to File Names<a class="headerlink" href="#connecting-records-to-file-names" title="Permalink to this heading"></a></h4>
<p>One common problem is the need to associate raw files with both the sample that was measured to generate them and the
measurements pulled from them. There are a few ways to do this and they all have advantages and disadvantages. You should
choose a way that is best for your situation.</p>
<ol class="arabic">
<li><p>Add a data_file field directly to the measurement record along with the recommended entity.id field.</p>
<ul class="simple">
<li><p>This makes it extremely easy to see which file the measurement came from, but that field is repeated a lot, and it is cumbersome to
figure out which file goes with which entity.</p></li>
</ul>
<p><span class="raw-html"><p></p></span></p>
</li>
<li><p>Create a storage file protocol for each raw file. The protocol would have fields for the file name or path, an entity.id
field that points to the entity it is associated with, and a protocol.id field that would point to the appropriate measurement protocol.</p>
<ul class="simple">
<li><p>This protocol could be a protocol for the measurement record or the entity that was measured.</p></li>
<li><p>This repeats the raw file field less, but requires the creation of many protocols that will likely dominate the protocol table,
all to hold a raw file name or path.</p></li>
<li><p>It is also not as straightforward to determine which raw file goes with which measurement,
since you have to match up the entity.id and/or protocol.id from the measurement record with those on the storage protocol.</p></li>
</ul>
<p><span class="raw-html"><p></p></span></p>
</li>
<li><p>A similar approach to the previous option is to create separate measurement protocols for each raw file and put the file name or path as a field
in the protocol. This has similar downsides to create storage protocols, but the measurement protocols have more significant
fields that will be repeated many times.</p>
<ul class="simple">
<li><p>This is easier to determine which raw file goes with which measurement, but takes a
little more work to link raw files with samples unless you also include an entity.id field on the protocol.</p></li>
</ul>
<p><span class="raw-html"><p></p></span></p>
</li>
<li><p>Add a data_files list field to both the entity and measurement protocol. Assuming you have an entity.id field on your
measurement records then you can cross reference the lists and what they have in common is the file for the measurement.</p>
<ul class="simple">
<li><p>This has a lot less repetition, but does require unique raw file names (this can be enforced using the protocol-dependent schema).</p></li>
<li><p>Although determining which file goes with which measurement can be done by cross referencing the lists, it is more complicated
than simply looking up a field.</p></li>
</ul>
<p><span class="raw-html"><p></p></span></p>
</li>
<li><p>Add a data_files list field and a data_files%entity_id onto the measurement protocol. The lists would be linked such that the
positions in each list correspond to one another. For example, if you have a data_files list on a measurement protocol,
[file1, file2], and a data_files%entity_id list, [entity1, entity2], then file1 would be associated with entity1 and file2
with entity2 because they are in the same numerical position in their respective lists.</p>
<ul class="simple">
<li><p>This does require the lists to be the same length and leaves open the possibility of the lists getting out of sync, but
if you use the automation tags with the extract command you can reduce the likelihood of that happening.</p></li>
<li><p>Determining which file goes with which measurement just requires matching the entity.id field of the
measurement record with a value in the data_files%entity_id list.</p></li>
<li><p>Determining the file that goes with the measurement or sample is more complicated than simply looking up a field,
but there is much less repetition of redundant information.</p></li>
<li><p>Compared with option 4 there is also the advantage that both lists are in 1 table and record.</p></li>
</ul>
<p><span class="raw-html"><p></p></span></p>
</li>
<li><p>Add a data_files list field and a data_files%measurement_protocol onto the entities. The lists would be linked such that the
positions in each list correspond to one another. For example, if you have a data_files list on an entity,
[file1, file2], and a data_files%measurement_protocol list, [protocol1, protocol2], then file1 would be associated with protocol1 and file2
with protocol2 because they are in the same numerical position in their respective lists.</p>
<ul class="simple">
<li><p>This does require the lists to be the same length and leaves open the possibility of the lists getting out of sync, but
if you use the automation tags with the extract command you can reduce the likelihood of that happening.</p></li>
<li><p>Determining which file goes with which measurement just requires matching the protocol.id field of the
measurement record with a value in the data_files%measurement_protocol list.</p></li>
<li><p>Determining the file that goes with the measurement is more complicated than simply looking up a field,
but there is much less repetition of redundant information.</p></li>
<li><p>Compared with option 4 there is also the advantage that both lists are in 1 table and record.</p></li>
</ul>
</li>
</ol>
<p>This was a decision we had to make for the data schema that would be expected when converting to the mwtab format. Ultimately,
we went with option 5. To see how this works you can look at the mwtab examples in the examples folder of the
<a class="reference external" href="https://github.com/MoseleyBioinformaticsLab/messes">GitHub</a> repository. Look at the #automate sheets of the measurements Excel files to see how you can easily add these
fields in a way that will reduce the chance of having misaligned lists. Also check out the protocol-dependent_schema
files to see how to enforce unique file names.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="conversion_directives.html" class="btn btn-neutral float-left" title="Conversion Directives" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="protocol_dependent_schema.html" class="btn btn-neutral float-right" title="Protocol-Dependent Schema" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Hunter Moseley, Travis Thompson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>